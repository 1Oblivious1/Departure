## ***Создание нового задания и нового достижения*** предназначено только для модерации и нажимается строго один раз при создании бд, так как каждое задание и достижение уникальны

---

# Взаимодействие пользователя с заданиями:

1. **Получение списка всех заданий**
```http
GET /api/task
```
Ответ: список всех доступных заданий с их описанием и координатами.

2. **Начало выполнения задания**
```http
POST /api/task/start
Content-Type: application/json

{
    "userId": 1,        // ID пользователя
    "taskId": 1         // ID задания
}
```
Ответ: информация о начатом задании, включая `submissionId` - уникальный идентификатор выполнения.

3. **Завершение задания с фото**
```http
POST /api/task/complete
Content-Type: application/json

{
    "userId": 1,        // ID пользователя
    "taskId": 1,        // ID задания
    "photoUrl": "..."   // URL загруженной фотографии
}
```
Ответ: информация о завершенном задании.

4. **Просмотр заданий пользователя**
```http
GET /api/task/user/{userId}/tasks
```
Ответ: список заданий пользователя, отсортированный следующим образом:
- Сначала активные задания (статус `Pending`), новые сверху
- Затем выполненные задания (статус `Completed`), старые снизу

Каждое задание в ответе содержит:
```json
{
    "taskId": 1,                // ID задания
    "title": "Название",        // Название задания
    "description": "Описание",  // Описание задания
    "difficulty": 0,            // Сложность (0=Easy, 1=Medium, 2=Hard)
    "latitude": 55.7558,        // Широта места задания
    "longitude": 37.6173,       // Долгота места задания
    "submissionId": 1,          // ID выполнения
    "status": "Pending",        // Статус (Pending/Completed)
    "startedAt": "2024-04-21T...", // Время начала
    "endedAt": null,            // Время завершения (null для активных)
    "photoUrl": null            // URL фото (если задание завершено)
}
```

**Важные моменты для фронтенда:**
1. Перед началом задания нужно проверить, что у пользователя еще не начато это задание. Для этого использовать запрос, который вернет список ID заданий пользователя:
```http
GET /api/task/user/1/task-ids
```
Ответ будет в формате:
```json
{
    "activeTaskIds": [1, 3, 5],    // ID активных заданий
    "completedTaskIds": [2, 4]      // ID выполненных заданий
}
```
2. При завершении задания обязательно нужно прикрепить фото
3. Статусы заданий:
   - `Pending` - задание начато, но не завершено
   - `Completed` - задание успешно завершено
4. Сортировка заданий в списке пользователя уже реализована на бэкенде
5. Координаты заданий можно использовать для отображения на карте

**Рекомендуемый порядок действий на фронтенде:**
1. Показать список доступных заданий
2. При выборе задания:
   - Проверить наличие связи между пользователем и этим заданием
   - Если нет - разрешить начать новое
   - Если есть - показать предупреждение
3. При завершении задания:
   - Получить URL фото
   - Отправить запрос на завершение с URL
4. В профиле пользователя показывать список его заданий с учетом сортировки

---

# Взаимодействие пользователя с лентой новостей и с конкретным постом:

```http
GET /api/task/news
```
- Возвращает список всех постов
- Сортировка по времени начала выполнения задания (started_at)
- Каждый пост содержит информацию о задании, пользователе и комментариях

## Получение конкретного поста

```http
GET {{backend_HostAddress}}/api/post/1
```
Ответ будет в формате:
```json
{
    "idNewsFeed": 1,            // ID поста в ленте
    "description": "Описание",  // Описание поста
    "createdAt": "2024-04-21T...", // Время начала выполнения
    "likes": 5,                 // Количество лайков
    "idTaskSubmission": 1,      // ID выполнения задания
    "idUser": 0,                // бесполезное поле, здесь всегда будет возвращаться 0, игнорировать и не использовать
    "photoUrl": "url.jpg",      // URL фотографии
    "idTask": 1,                // ID задания
    "title": "Название",        // Название задания
    "taskDescription": "Описание", // Описание задания
    "difficulty": 0,            // Сложность (Easy/Medium/Hard)
    "latitude": 55.7558,        // Широта места задания
    "longitude": 37.6173,       // Долгота места задания
    "idUserProfilePublic": 1,   // ID публичного профиля
    "name": "Имя",              // Имя пользователя
    "avatarUrl": "example.com"  // Аватарка пользователя
    "comments": [               // Список комментариев
        {
            "idComment": 1,     // ID комментария
            "text": "Текст",    // Текст комментария
            "authorName": "Имя", // Имя автора
            "idUserProfilePublic": 1, // ID публичного профиля автора
            "avatarUrl": "example.com"  // Аватарка пользователя
            "submittedAt": "2024-04-21T..." // Время отправки
        }
    ]
}
```
- Возвращает полную информацию о посте по его ID
- Формат ответа идентичен формату поста в ленте новостей
- Кнопка "Добавить в избранное" описана ниже

## Добавление комментария
```http
POST /api/post/{id}/comment
Content-Type: application/json

{
    "userId": 1,
    "text": "Текст комментария"
}
```
- Добавляет новый комментарий к посту
- Возвращает обновленный пост с новым комментарием

## Лайк поста
```http
POST /api/post/{id}/like
```
- Увеличивает счетчик лайков на 1
- Возвращает обновленный пост

## Важные моменты:
1. Все запросы возвращают полную информацию о посте
2. Комментарии загружаются вместе с постами
3. Время создания поста берется из started_at в TaskSubmission
4. Имя пользователя берется из UserProfilePublic
5. Фотография хранится в TaskSubmission (photo_url)

---

# Достижения:

## Получение достижений пользователя
```http
GET {{backend_HostAddress}}/api/achievement/user/1
```
Ответ будет в формате:
```json
[
  {
    "idUserAchievement": 1,  // ID достижения в таблице достижений
    "name": "Первые шаги",   // Название достижения
    "points": 100            // Количество очков, получаемое пользователем за выполнение достижения
  }
]
```
- Возвращает список всех достижений, полученных пользователем

---

# Избранное:

## Получение избранных постов пользователя
```http
GET {{backend_HostAddress}}/api/user/favorites/1
```
Ответ будет в формате:
```json
    "posts": [...]       // Все избранные посты пользователя (отображаются как в ленте новостей)
```
- Вкладка избранное должна быть доступна только в своем профиле
- Запрос возвращает список всех постов, которые пользователь пометил избранными

## Добавление поста в избранное
```http
POST {{backend_HostAddress}}/api/user/favorites/add
Content-Type: application/json

{
    "userId": 1,
    "postId": 1
}
```
- Добавляет выбранный пост в избранное
- Ничего не возвращает

## Удаление поста из избранного
```http
DELETE {{backend_HostAddress}}/api/user/favorites/delete
Content-Type: application/json

{
    "userId": 1,
    "postId": 1
}
```
- Удаляет выбранный пост из избранного
- Ничего не возвращает

## Проверка статуса избранного
```http
GET {{backend_HostAddress}}/api/user/favorites/status
Content-Type: application/json

{
    "userId": 1,
    "postId": 1
}
```
Ответ будет в формате:
```json
    1     // 1 - если пост есть в избранном, 0 - если поста нет в избранном
```
- Если 1, кнопка "Удалить из избранного"
- Если 0, кнопка "Добавить в избранное"

---

# Подписчики/подписки:

## Подписаться на пользователя
```http
POST {{backend_HostAddress}}/api/user/subscribe
Content-Type: application/json

{
    "subscriberId": 1,
    "targetUserId": 2
}
```
- **Важно**: в беке уже есть проверка на повторные подписки и подписки на себя. Здесь при нажатии на кнопку нужно изменить ее на "Отписаться"
- Кнопка "Отписаться" описана ниже
- Запрос ничего не возвращает

## Отписаться от пользователя
```http
POST {{backend_HostAddress}}/api/user/unsubscribe
Content-Type: application/json

{
    "subscriberId": 1,
    "targetUserId": 2
}
```
- **Важно**: в беке уже есть проверка на повторные отписки. Здесь при нажатии на кнопку нужно изменить ее на "Подписаться"
- Кнопка "Подписаться" описана ниже
- Запрос ничего не возвращает

## Получить подписчиков/подписки пользователя
```http
GET {{backend_HostAddres}}/api/user/1/subscriptions
```
Ответ будет в формате:
```json
{
  "subscriptions": [
    {
      "idUserProfilePublic": 2,                 // ID пользователя, на которого подписан данный аккаунт
      "name": "test1",                          // Имя этого пользователя
      "points": 10,                             // Очки этого пользователя
      "createdAt": "2025-04-24T00:00:00",       // Бесполезное поле, не использовать
      "avatarUrl": "https://encrypted..."       // Аватар этого пользователя
    }
  ],
  "subscribers": [
    {
      "idUserProfilePublic": 2,                 // ID пользователя, который подписан на данный аккаунт
      "name": "test1",                          // Имя этого пользователя
      "points": 10,                             // Очки этого пользователя
      "createdAt": "2025-04-24T00:00:00",       // Бесполезное поле, не использовать
      "avatarUrl": "https://encrypted..."       // Аватар этого пользователя
    }
  ]
}
```
- Запрос возвращет отдельно список подписок и список подписчиков
- В профиле будет отображаться количество подписчиков и подписок пользователя. При нажатии на эти цифры будет выполняться данный запрос
- Подписчиков и подписки можно посмотреть у любого пользователя
- Подписчики и подписки будут представлены двумя разными списками. Можно добавить рядом с каждым из них кнопку "Подписаться/Отписаться"
- Проверка на то, какую кнопку размещать в профиле, будет описана ниже

## Проверить статус подписки
```http
POST {{backend_HostAddress}}/api/user/check-subscription
Content-Type: application/json

{
    "subscriberId": 1,
    "targetUserId": 1
}
```
Ответ будет в формате:
```json
    2   // возвращает цифру (0, 1 или 2)
```
- 0 - если это профиль самого пользователя
- 1 - если пользователь уже подписан (нужна кнопка "Отписаться")
- 2 - если пользователь еще не подписан (нужна кнопка "Подписаться")

---

# Профиль:

**Важно**: При переходе в чужой профиль фронтенд должен запоминать как ID текущего пользователя, так и ID пользователя, в профиль которого он перешел - для взаимодействия между данными пользователями

### Таблица рейтинга пользователей
```http
GET {{backend_HostAddress}}/api/user/rating/1
```
Ответ будет в формате:
```json
{
  "userRank": 1,                 // ID пользователя, отправившего запрос
  "rating": [
    {
      "idUserProfilePublic": 5,                 // ID пользователя
      "name": "test1",                          // Имя этого пользователя
      "points": 110,                            // Очки этого пользователя
      "createdAt": "0001-01-01T00:00:00",       // Бесполезное поле, не использовать
      "avatarUrl": "https://encrypted..."       // Аватар этого пользователя
    }
  ]
}
```
- Запрос возвращает список всех пользователей, отсортированный по рейтингу
- Перед рейтингом возвращается позиция пользователя, отправившего запрос, в этом рейтинге

## Переход в профиль
```http
GET {{backend_HostAddress}}/api/user/profile/1
```
Ответ будет в формате:
```json
{
  "profile": {
    "idUserProfilePublic": 1,                 // ID пользователя
    "name": "test1",                          // Имя этого пользователя
    "points": 40,                             // Очки этого пользователя
    "createdAt": "2025-04-21T00:00:00",       // Бесполезное поле, не использовать
    "avatarUrl": "https://i.pinimg.com..."    // Аватар этого пользователя
  },
  "subscribersCount": 2,                      // Количество подписчиков
  "subscriptionsCount": 2,                    // Количество подписок
  "completedTasksCount": 9,                   // Количество выполненных заданий
  "totalLikes": 7,                            // Сумма лайков, полученных пользователем
  "posts": [...]                              // Все посты пользователя (отображаются как в ленте новостей)
}
```
- Добавить кнопку избранное (если это мой профиль)
- Добавить кнопку достижений (для всех пользователей)
- Добавить кнопку подписчиков/подписок (для всех польхователей). Отображает сумму подписчиков и подписок пользователя. При нажатии на нее выполняется запрос "Получить подписчиков/подписки пользователя"
- Добавить кнопку подписаться (если это мой профиль → скрыть кнопку подписки; если я подписан → кнопка "Отписаться"; если не подписан → кнопка "Подписаться")